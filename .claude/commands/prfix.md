# プルリクエストのレビュー対応コマンド

GitHub CLIを使用してPRのレビューコメントを取得し、修正を行い、コメントに返信するコマンド。

## ロール
あなたはゲームプログラマです。
レビューされた内容を確認して、仕様に沿った修正を実装してください。

## 引数
コマンド引数には `{PR番号}` が渡される。
- 例: `/prfix 10`
- PR番号がない場合は、処理を終了する。

## 事前に確認しておくルール
これはメモリ上に展開済みの場合は省略してよい
- `spec/rule` フォルダの中身を確認し、コーディングルールを把握しておくこと
- `CLAUDE.md` を確認し、アーキテクチャルールを把握しておくこと

## 処理フロー

### 1. PR情報の取得
```bash
gh pr view {PR番号} --json number,headRefName,headRepository
```
- PR番号、ブランチ名、リポジトリ情報を取得する

### 2. レビューコメントの取得
```bash
gh api repos/{owner}/{repo}/pulls/{PR番号}/comments
```
- レビューコメントの一覧を取得する
- 各コメントから以下の情報を抽出:
  - `id`: コメントID（返信時に使用）
  - `body`: コメント本文（修正内容）
  - `path`: 対象ファイルパス
  - `line`: 対象行番号
  - `diff_hunk`: 差分コンテキスト

### 3. 修正タスクの作成
- レビューコメントを分析し、修正が必要なタスクを特定する
- 各タスクに対して以下を記録:
  - コメントID
  - 対象ファイル
  - 修正内容

### 4. 修正の実施
各タスクに対して:
1. 対象ファイルを読み込む
2. レビュー指摘に従って修正を行う
3. 修正したファイルのみをステージング
4. コミットを作成（メッセージに`fix: レビュー指摘対応`を含める）

### 5. プッシュ
```bash
git push
```

### 6. コメントへの返信
各修正タスクに対して:
```bash
gh api -X POST "repos/{owner}/{repo}/pulls/{PR番号}/comments/{コメントID}/replies" -f body="修正しました。{修正内容の説明}"
```

### 7. ログ出力
`log/` フォルダに対応ログを出力する。
ファイル名: `issue-{Issue番号}-prfix.md`

## 便利なGitHub CLIコマンド

### PRレビューコメント取得
```bash
gh api repos/{owner}/{repo}/pulls/{PR番号}/comments
```

### PRレベルコメント取得
```bash
gh api repos/{owner}/{repo}/issues/{PR番号}/comments
```

### コメントへの返信
```bash
gh api -X POST "repos/{owner}/{repo}/pulls/{PR番号}/comments/{コメントID}/replies" -f body="返信内容"
```

## 注意事項
- 修正は1コメントずつ個別にコミットすること
- コメントへの返信は修正完了後に行うこと
- Nitpick（軽微な指摘）は対応判断をユーザーに確認すること
